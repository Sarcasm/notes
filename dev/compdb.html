<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>compdb &#8212; Sarcasm tips  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=e491ac2d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compilation database" href="compilation-database.html" />
    <link rel="prev" title="Clang-Tidy" href="clang-tidy.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>Sarcasm tips  documentation</span></a></h1>
        <h2 class="heading"><span>compdb</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="clang-tidy.html">Clang-Tidy</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="compilation-database.html">Compilation database</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="compdb">
<h1>compdb<a class="headerlink" href="#compdb" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#release-procedure" id="id1">Release procedure</a></p>
<ul>
<li><p><a class="reference internal" href="#increment-version" id="id2">Increment version</a></p></li>
<li><p><a class="reference internal" href="#run-tests" id="id3">Run tests</a></p></li>
<li><p><a class="reference internal" href="#make-git-tag" id="id4">Make git tag</a></p></li>
<li><p><a class="reference internal" href="#publish-on-pypi" id="id5">Publish on Pypi</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="release-procedure">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Release procedure</a><a class="headerlink" href="#release-procedure" title="Link to this heading">¶</a></h2>
<p>Clone latest Github release to a new <code class="docutils literal notranslate"><span class="pre">compdb-dist</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">Sarcasm</span><span class="o">/</span><span class="n">compdb</span><span class="o">.</span><span class="n">git</span> <span class="n">compdb</span><span class="o">-</span><span class="n">dist</span>
<span class="n">cd</span> <span class="n">compdb</span><span class="o">-</span><span class="n">dist</span>
</pre></div>
</div>
<section id="increment-version">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Increment version</a><a class="headerlink" href="#increment-version" title="Link to this heading">¶</a></h3>
<p>Increment version in <code class="docutils literal notranslate"><span class="pre">compdb/__about__.py</span></code>.</p>
</section>
<section id="run-tests">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Run tests</a><a class="headerlink" href="#run-tests" title="Link to this heading">¶</a></h3>
<p>Run test suite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tox</span> <span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">missing</span><span class="o">-</span><span class="n">interpreters</span>
</pre></div>
</div>
<p>README validation for PyPI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">long</span><span class="o">-</span><span class="n">description</span> <span class="o">|</span> <span class="n">rst2html</span><span class="o">.</span><span class="n">py</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">output</span><span class="o">.</span><span class="n">html</span>
<span class="n">chromium</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">output</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>Install locally for following tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">.</span><span class="n">venv</span><span class="o">-</span><span class="n">release</span>
<span class="n">virtualenv</span> <span class="o">.</span><span class="n">venv</span><span class="o">-</span><span class="n">release</span>
<span class="n">source</span> <span class="o">.</span><span class="n">venv</span><span class="o">-</span><span class="n">release</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>Regression tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">.</span><span class="n">venv</span><span class="o">-</span><span class="n">release</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">pushd</span> <span class="n">tests</span><span class="o">/</span><span class="n">regression</span><span class="o">/</span><span class="n">headerdb</span>
<span class="n">make</span> <span class="n">clean</span>
<span class="n">make</span> <span class="nb">all</span>
<span class="n">popd</span>
</pre></div>
</div>
<p>Packaging tests (requires Docker):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">tests</span><span class="o">/</span><span class="n">integration</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">-</span><span class="n">trusty</span><span class="o">.</span><span class="n">sh</span> \
    <span class="n">tests</span><span class="o">/</span><span class="n">integration</span><span class="o">/</span><span class="n">packaging</span><span class="o">-</span><span class="n">trusty</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Contrib scripts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">.</span><span class="n">venv</span><span class="o">-</span><span class="n">release</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="o">./</span><span class="n">contrib</span><span class="o">/</span><span class="n">zsh</span><span class="o">/</span><span class="n">check</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">helps</span>
</pre></div>
</div>
</section>
<section id="make-git-tag">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Make git tag</a><a class="headerlink" href="#make-git-tag" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">COMPDB_VERSION</span><span class="o">=</span><span class="k">$(</span>python<span class="w"> </span>compdb<span class="w"> </span>version<span class="w"> </span>--short<span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;tagging </span><span class="nv">$COMPDB_VERSION</span><span class="s2">&quot;</span>
git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span>v<span class="nv">$COMPDB_VERSION</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;compdb </span><span class="nv">$COMPDB_VERSION</span><span class="s2">&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>--follow-tags
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>Use annotated tags, lightweight tags aren’t appropriate for releases,
they are for local development.
Annotated tags can have author, date and message.
They are shown by default when using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">describe</span></code>,
that is not the case for lightweight tags.
However, regarding the message, it seems a bit useful,
at least the way it is used by many projects in the wild:
“version X.Y.Z”, “project X.Y.Z”, “X.Y.Z”, …
It could make sense to use an empty message <code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">''</span></code>.
Alternatively they could be use to contain the release notes
but there are no official format (e.g. Markdown),
so this may better be in the project’s documentation.
On Github, release notes, have to be written manually anyway:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/Sarcasm/compdb/releases">https://github.com/Sarcasm/compdb/releases</a></p></li>
</ul>
</li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">--follow-tags</span></code> will only push annotated tags,
that are reacheable (an ancestor) from the pushed commits.</p></li>
<li><p>Potential improvement, sign releases:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/flycheck/flycheck/blob/424a78328518e1dabf830f792ce9c4aa1ff7fc7e/doc/contributor/maintaining.rst#signatures-for-commits-and-tags">https://github.com/flycheck/flycheck/blob/424a78328518e1dabf830f792ce9c4aa1ff7fc7e/doc/contributor/maintaining.rst#signatures-for-commits-and-tags</a></p></li>
</ul>
</li>
</ul>
<p>Make pretty release note on Github release page:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/Sarcasm/compdb/releases/">https://github.com/Sarcasm/compdb/releases/</a></p></li>
</ul>
</section>
<section id="publish-on-pypi">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Publish on Pypi</a><a class="headerlink" href="#publish-on-pypi" title="Link to this heading">¶</a></h3>
<p>One time configuration,
steps to do again only if the release environment changes.</p>
<p>Create a <code class="docutils literal notranslate"><span class="pre">~/.pypirc</span></code> with this content:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[distutils]</span>
<span class="na">index-servers</span><span class="o">=</span><span class="s">pypi</span>

<span class="k">[pypi]</span>
<span class="na">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Sarcasm</span>
<span class="na">EOF</span>
</pre></div>
</div>
<p>Make sure to remove any resident packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">dist</span><span class="o">/*</span>
</pre></div>
</div>
<p>Build source distribution and universal wheel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">.</span><span class="n">venv</span><span class="o">-</span><span class="n">release</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">wheel</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">sdist</span> <span class="n">bdist_wheel</span>
</pre></div>
</div>
<p>Upload packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">.</span><span class="n">venv</span><span class="o">-</span><span class="n">release</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">twine</span>
<span class="n">twine</span> <span class="n">upload</span> <span class="n">dist</span><span class="o">/*</span>
</pre></div>
</div>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="clang-tidy.html">Clang-Tidy</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="compilation-database.html">Compilation database</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2016-2021, Guillaume Papin.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.2.
    </div>
  </body>
</html>